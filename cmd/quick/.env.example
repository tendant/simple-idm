# Quick IDM - Minimal Configuration
# Copy this file to .env and update values for your environment

# =============================================================================
# APPLICATION (REQUIRED)
# =============================================================================
BASE_URL=http://localhost:4000
FRONTEND_URL=http://localhost:3000

# =============================================================================
# DATABASE (REQUIRED)
# =============================================================================
IDM_PG_HOST=localhost
IDM_PG_PORT=5432
IDM_PG_DATABASE=idm_db
IDM_PG_USER=idm
IDM_PG_PASSWORD=pwd
IDM_PG_SCHEMA=public

# =============================================================================
# EMAIL (REQUIRED for magic link / passwordless login)
# =============================================================================
# For local development, use Mailpit (docker/start-mailpit.sh)
EMAIL_HOST=localhost
EMAIL_PORT=1025
EMAIL_FROM=noreply@example.com
EMAIL_USERNAME=
EMAIL_PASSWORD=
EMAIL_TLS=false

# Production SMTP example:
# EMAIL_HOST=smtp.gmail.com
# EMAIL_PORT=587
# EMAIL_FROM=your-email@gmail.com
# EMAIL_USERNAME=your-email@gmail.com
# EMAIL_PASSWORD=your-app-password
# EMAIL_TLS=true

# =============================================================================
# JWT (AUTO-CONFIGURED - Optional overrides)
# =============================================================================
# RSA private key file (auto-generated on first run if missing)
JWT_KEY_FILE=jwt-private.pem

# JWT issuer (used in OIDC claims)
JWT_ISSUER=quick-idm

# Token expiration (ISO 8601 duration format)
ACCESS_TOKEN_EXPIRY=15m
REFRESH_TOKEN_EXPIRY=24h
TEMP_TOKEN_EXPIRY=10m

# =============================================================================
# REGISTRATION (Optional)
# =============================================================================
REGISTRATION_ENABLED=true
REGISTRATION_DEFAULT_ROLE=user

# =============================================================================
# MAGIC LINK (Optional)
# =============================================================================
MAGIC_LINK_EXPIRATION=1h

# =============================================================================
# OAUTH2 CLIENT ENCRYPTION (Optional)
# =============================================================================
# 32-byte hex key for encrypting OAuth2 client secrets in database
# Auto-generated if not provided (OK for dev, set for production)
# Generate with: openssl rand -hex 32
# OAUTH2_CLIENT_ENCRYPTION_KEY=your-64-character-hex-string

# =============================================================================
# COOKIES (Optional)
# =============================================================================
COOKIE_SECURE=false
COOKIE_HTTP_ONLY=true

# =============================================================================
# QUICK START GUIDE
# =============================================================================
# 1. Setup Database:
#    createdb idm_db
#    make migration-up
#
# 2. Start Email Server (development):
#    docker/start-mailpit.sh
#    # View emails at http://localhost:8025
#
# 3. Configure this file:
#    cp .env.example .env
#    # Edit database and email settings if needed
#
# 4. Run the service:
#    go run main.go
#    # RSA keys auto-generated on first run
#    # Admin credentials shown once - save them!
#
# 5. Test OIDC Discovery:
#    curl http://localhost:4000/.well-known/openid-configuration
#
# 6. Create OAuth2 Client (for your apps):
#    # Login as admin â†’ POST /api/oauth2-clients
#    # Use the client_id and client_secret in your app
#
# =============================================================================
# ENDPOINTS
# =============================================================================
# Authentication:
#   POST   /api/auth/login                    - Password login
#   POST   /api/auth/magic-link/email         - Request magic link
#   GET    /api/auth/magic-link/validate      - Validate magic link
#   POST   /api/auth/token/refresh            - Refresh access token
#   POST   /api/auth/logout                   - Logout
#
# Registration:
#   POST   /api/signup/passwordless           - Register without password
#   POST   /api/signup/register               - Register with password
#
# OAuth2/OIDC:
#   GET    /.well-known/openid-configuration  - OIDC discovery
#   GET    /.well-known/jwks.json             - Public keys
#   GET    /api/oauth2/authorize              - Authorization endpoint
#   POST   /api/oauth2/token                  - Token endpoint
#   GET    /api/oauth2/userinfo               - UserInfo endpoint
#
# Management (requires auth):
#   GET    /me                                - Current user info
#   *      /api/users/*                       - User management
#   *      /api/roles/*                       - Role management (admin)
#   *      /api/oauth2-clients/*              - OAuth2 client management (admin)
